"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[4735],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>h});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},m="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),m=p(n),c=i,h=m["".concat(s,".").concat(c)]||m[c]||u[c]||r;return n?a.createElement(h,o(o({ref:t},d),{},{components:n})):a.createElement(h,o({ref:t},d))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[m]="string"==typeof e?e:i,o[1]=l;for(var p=2;p<r;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},84828:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>l,toc:()=>p});var a=n(87462),i=(n(67294),n(3905));const r={},o="Back-end Java contribution guide",l={unversionedId:"dev-guides/BackEndJavaContributionGuide",id:"dev-guides/BackEndJavaContributionGuide",title:"Back-end Java contribution guide",description:"Useful links",source:"@site/docs/dev-guides/BackEndJavaContributionGuide.mdx",sourceDirName:"dev-guides",slug:"/dev-guides/BackEndJavaContributionGuide",permalink:"/docs/dev-guides/BackEndJavaContributionGuide",draft:!1,editUrl:"https://github.com/reportportal/docs/blob/develop/docs/dev-guides/BackEndJavaContributionGuide.mdx",tags:[],version:"current",frontMatter:{},sidebar:"defaultSidebar",previous:{title:"Attachments (Screenshots) Guide",permalink:"/docs/dev-guides/AttachmentsGuide"},next:{title:"Interactions between API and Analyzer",permalink:"/docs/dev-guides/InteractionsBetweenAPIAndAnalyzer"}},s={},p=[{value:"Useful links",id:"useful-links",level:2},{value:"Deployment components description",id:"deployment-components-description",level:2},{value:"Code conventions",id:"code-conventions",level:2},{value:"IDE Formatter",id:"ide-formatter",level:3},{value:"Code style",id:"code-style",level:3},{value:"Git branch requirements",id:"git-branch-requirements",level:3},{value:"Open-source contribution workflow",id:"open-source-contribution-workflow",level:2},{value:"Dev environment setup",id:"dev-environment-setup",level:2},{value:"Pre requirements",id:"pre-requirements",level:3},{value:"How to keep DB data up-to-date",id:"how-to-keep-db-data-up-to-date",level:4},{value:"Service Authorization",id:"service-authorization",level:3},{value:"Service API",id:"service-api",level:3},{value:"Service Jobs",id:"service-jobs",level:3},{value:"Service UI",id:"service-ui",level:3},{value:"Development workflow",id:"development-workflow",level:2},{value:"Introduction to dependencies",id:"introduction-to-dependencies",level:3},{value:"Updates in dependencies",id:"updates-in-dependencies",level:3},{value:"Summary notes",id:"summary-notes",level:2}],d={toc:p},m="wrapper";function u(e){let{components:t,...r}=e;return(0,i.kt)(m,(0,a.Z)({},d,r,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"back-end-java-contribution-guide"},"Back-end Java contribution guide"),(0,i.kt)("h2",{id:"useful-links"},"Useful links"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://reportportal.io"},"Landing page")),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://reportportal.io/docs"},"Official documentation")),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/reportportal/reportportal/wiki/Contribution"},"Contribution notes on GitHub")),(0,i.kt)("h2",{id:"deployment-components-description"},"Deployment components description"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://traefik.io"},"Traefik")," as reversed proxy and application entry point"),(0,i.kt)("li",{parentName:"ul"},"Data analysis",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.elastic.co/elasticsearch"},"Elasticsearch")," as logs analysis data storage"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/reportportal/service-auto-analyzer"},"Service Analyzer")," as log messages analysis tool"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/reportportal/service-auto-analyzer"},"Service Analyzer Train")," is a ",(0,i.kt)("inlineCode",{parentName:"li"},"Service Analyzer")," running in training mode to increase analysis quality"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/reportportal/service-metrics-gatherer"},"Service Metrics Gatherer")," as training model manager and ",(0,i.kt)("inlineCode",{parentName:"li"},"Service Analyzer")," monitoring"))),(0,i.kt)("li",{parentName:"ul"},"Database",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.postgresql.org"},"Postgresql")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/reportportal/migrations"},"Service Migrations")," - service for DB schema and data updates"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.rabbitmq.com"},"RabbitMQ")," - message broker for inter-service communication"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://min.io"},"Minio")," - binary data storage (alternative to plain filesystem storage)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/reportportal/service-index"},"Service Index")," - gateway service with services metadata resolving mechanism"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/reportportal/service-ui"},"Service UI")," - ReportPortal web UI")),(0,i.kt)("p",null,"There are three Java repositories that are part of the whole RP deployment:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/reportportal/service-api"},"Service API")," - REST API service as ReportPortal functionality provider"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/reportportal/service-authorization"},"Service Authorization")," - REST Authorization service for users authentication"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/reportportal/service-jobs"},"Service Jobs")," - Service with jobs to process data in the back-ground")),(0,i.kt)("h2",{id:"code-conventions"},"Code conventions"),(0,i.kt)("h3",{id:"ide-formatter"},"IDE Formatter"),(0,i.kt)("p",null,"Settings file can be found at: ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/reportportal/reportportal/blob/master/idea_formatting_profile.xml"},"https://github.com/reportportal/reportportal/blob/master/idea_formatting_profile.xml"),"\nSteps to import:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},'Click on IDEA "Preferences"'),(0,i.kt)("li",{parentName:"ul"},'Choose "Editor" section'),(0,i.kt)("li",{parentName:"ul"},'Click on "Code style"'),(0,i.kt)("li",{parentName:"ul"},'In "Scheme" section click on settings wheel \u2192 Import Scheme \u2192 IntelliJ IDEA code style XML')),(0,i.kt)("media-view",{src:n(65914),alt:"Idea Formatter"}),(0,i.kt)("h3",{id:"code-style"},"Code style"),(0,i.kt)("p",null,"This document is aimed to improve some points in existing code base and implementation/design approaches synchronization inside team. It's a blueprint for now, but will be improved."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Code should be simple and readable as possible."),(0,i.kt)("li",{parentName:"ul"},"Avoid using useless interfaces. For our case, if we aren't planning to extend functionality, and can simply refactor\n(For example it isn't some separated library build with some magic),\nand if we don't need another implementation for example for some tests(mock, anonymous classes etc.),\ncode auto-generation (@repository for example) and so on(another real needed cases), than we should to avoid creating interface."),(0,i.kt)("li",{parentName:"ul"},"Methods and Classes should be named accordingly to their responsibilities, name should be clear or description should be added otherwise\n(For instance, difficult to describe responsibility in only few words)."),(0,i.kt)("li",{parentName:"ul"},"Methods with the same names(overloading/overriding) should do similar things."),(0,i.kt)("li",{parentName:"ul"},"Parameters in overloaded methods should have the same order of the same parameters: same parameters at the beginning of the list, different at the end of the list."),(0,i.kt)("li",{parentName:"ul"},"Name of parameters should be clear. For example, if used id, it should be clear to which entity it's related. May be used ",(0,i.kt)("inlineCode",{parentName:"li"},"entity"),"Id instead (userId, projectId, etc.)."),(0,i.kt)("li",{parentName:"ul"},"Same related to return parameters. Should be clear, for example, if it's Long, and it's not some calculations, than should be added explanation in description."),(0,i.kt)("li",{parentName:"ul"},"Try to use suitable structure, to avoid useless converting."),(0,i.kt)("li",{parentName:"ul"},"Try to move usually used flows (checks, or structure processing, etc.) to utils."),(0,i.kt)("li",{parentName:"ul"},"Avoid using manually work with threads (use defined ",(0,i.kt)("inlineCode",{parentName:"li"},"TaskExecutor")," or create a new one)."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"Optional")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"Stream")," should be mostly used in cases when it really improves readability."),(0,i.kt)("li",{parentName:"ul"},"Always return ",(0,i.kt)("inlineCode",{parentName:"li"},"Optional")," instead of ",(0,i.kt)("inlineCode",{parentName:"li"},"null"),"."),(0,i.kt)("li",{parentName:"ul"},"For ",(0,i.kt)("inlineCode",{parentName:"li"},"Stream")," avoid double terminal operations. (Stream to list then back to stream to collect to list).")),(0,i.kt)("h3",{id:"git-branch-requirements"},"Git branch requirements"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Working branch name must be started with jira-id(EPMRPP-DDD)(-optional-description), for example:\n",(0,i.kt)("inlineCode",{parentName:"li"},"EPMRPP-444")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"EPMRPP-443-fix-some-bugs"),". That also means, all Jira branches must be related to some Jira ticked, only jira-id should be a trigger for branch creation\n(excluding some technical branches master, develop, release etc)."),(0,i.kt)("li",{parentName:"ul"},"All commit messages in ",(0,i.kt)("inlineCode",{parentName:"li"},"master"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"develop")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"release")," branches must be started with jira-id as well: EPMRPP-445 Some important fix."),(0,i.kt)("li",{parentName:"ul"},"Better to divide commits into small bug logic completed parts into the branch, to ease understanding during code review."),(0,i.kt)("li",{parentName:"ul"},"When merging a PR into the mainstream branch (",(0,i.kt)("inlineCode",{parentName:"li"},"master"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"develop"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"release"),") all commits should be squashed and provided with suitable description with jira-id by person who performs merge.")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"For contributors that have no access to our Jira tasks branch name prefix should be GitHub ",(0,i.kt)("inlineCode",{parentName:"strong"},"issue")," name"),"\nIt is highly recommended creating an issue that doesn't already exist and then fix it within your PR.\nEven if it's some new function. Issue will stay there with all your ideas and comments from other contributors.\nAlso, RP users who are not developers might prefer to look through issues\nrather than PRs to check if something is already fixed in a new version of ReportPortal."),(0,i.kt)("h2",{id:"open-source-contribution-workflow"},"Open-source contribution workflow"),(0,i.kt)("p",null,"All features fixes should be added to ",(0,i.kt)("inlineCode",{parentName:"p"},"develop")," branch only, exclusions: hot-fixes"),(0,i.kt)("p",null,"Changes applying workflow:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Clone repository or fork from it"),(0,i.kt)("li",{parentName:"ul"},"Checkout ",(0,i.kt)("inlineCode",{parentName:"li"},"develop")," branch"),(0,i.kt)("li",{parentName:"ul"},"Create branch according to name policy"),(0,i.kt)("li",{parentName:"ul"},"Push branch to the remote"),(0,i.kt)("li",{parentName:"ul"},"Create PR according to name policy into the ",(0,i.kt)("inlineCode",{parentName:"li"},"develop")," branch of the RP repository"),(0,i.kt)("li",{parentName:"ul"},"Review and merge/reject PR (squash commits in one during merge)")),(0,i.kt)("h2",{id:"dev-environment-setup"},"Dev environment setup"),(0,i.kt)("h3",{id:"pre-requirements"},"Pre requirements"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Postgresql should be deployed"),(0,i.kt)("li",{parentName:"ul"},"Service Migration should fill/update DB data"),(0,i.kt)("li",{parentName:"ul"},"Binary data storage should be configured")),(0,i.kt)("p",null,"To deploy DB with the latest schema we need the ",(0,i.kt)("inlineCode",{parentName:"p"},"docker-compose.yml")," that looks like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'version: \'2.4\'\nservices:\n\n  postgres:\n    image: postgres:12-alpine\n    shm_size: \'512m\'\n    environment:\n      POSTGRES_USER: rpuser\n      POSTGRES_PASSWORD: rppass\n      POSTGRES_DB: reportportal\n    volumes:\n      # For unix host\n      - ./data/postgres:/var/lib/postgresql/data\n      # For windows host\n      # - postgres:/var/lib/postgresql/data\n    ports:\n      - "5432:5432"\n    command:\n      -c checkpoint_completion_target=0.9\n      -c work_mem=96MB\n      -c wal_writer_delay=20ms\n      -c synchronous_commit=off\n      -c wal_buffers=32MB\n      -c min_wal_size=2GB\n      -c max_wal_size=4GB\n    healthcheck:\n      test: ["CMD-SHELL", "pg_isready -d $$POSTGRES_DB -U $$POSTGRES_USER"]\n      interval: 10s\n      timeout: 120s\n      retries: 10\n    restart: always\n  \n  db-scripts:\n    image: reportportal/migrations:5.6.0\n    depends_on:\n      postgres:\n        condition: service_healthy\n    environment:\n      POSTGRES_SERVER: postgres\n      POSTGRES_PORT: 5432\n      POSTGRES_DB: reportportal\n      POSTGRES_USER: rpuser\n      POSTGRES_PASSWORD: rppass\n    restart: on-failure\n')),(0,i.kt)("h4",{id:"how-to-keep-db-data-up-to-date"},"How to keep DB data up-to-date"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"image: reportportal/migrations:5.6.0")," is the released version of the migrations service, but if there were any changes in the ",(0,i.kt)("inlineCode",{parentName:"p"},"develop")," branch\nthey won't be available in released version so migrated DB schema may be outdated.\nTo prevent this and have DB data up-to-date you should do the following:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"clone/update ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/reportportal/migrations"},"Migrations Repository")),(0,i.kt)("li",{parentName:"ul"},"checkout ",(0,i.kt)("inlineCode",{parentName:"li"},"develop")," branch"),(0,i.kt)("li",{parentName:"ul"},"run the following command:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"docker-compose run --rm migrations\n")),(0,i.kt)("p",null,"This flow will use all SQL scripts in the ",(0,i.kt)("inlineCode",{parentName:"p"},"develop")," branch and update your locally running DB instance."),(0,i.kt)("br",null),(0,i.kt)("p",null,"By default, filesystem storage is used for binary data (all data will be stored on your local filesystem).\nIf you want to store binaries using Minio (as we do on our production) you should deploy it too by adding this to already existing ",(0,i.kt)("inlineCode",{parentName:"p"},"docker-compose.yml"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'  minio:\n    image: minio/minio:RELEASE.2020-10-27T04-03-55Z\n    ports:\n      - \'9000:9000\'\n    volumes:\n      # For unix host\n      - ./data/storage:/data\n      # For windows host\n      # - minio:/data\n    environment:\n      MINIO_ACCESS_KEY: minio\n      MINIO_SECRET_KEY: minio123\n    command: server /data\n    healthcheck:\n      test: ["CMD", "curl", "-f", "http://localhost:9000/minio/health/live"]\n      interval: 30s\n      timeout: 20s\n      retries: 3\n    restart: always\n')),(0,i.kt)("p",null,"Pay attention to ",(0,i.kt)("inlineCode",{parentName:"p"},"Windows")," comments - if you develop on ",(0,i.kt)("inlineCode",{parentName:"p"},"Windows")," uncomment sections for windows\nand comment ",(0,i.kt)("inlineCode",{parentName:"p"},"Linux"),"-related sections both for Postgres and Minio\nthen add next statement to the ",(0,i.kt)("inlineCode",{parentName:"p"},"docker-compose.yml"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"volumes:\n  postgres:\n  minio:\n")),(0,i.kt)("p",null,"As the result we have the ",(0,i.kt)("inlineCode",{parentName:"p"},"docker-compose.yml"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'version: \'2.4\'\nservices:\n\n  postgres:\n    image: postgres:12-alpine\n    shm_size: \'512m\'\n    environment:\n      POSTGRES_USER: rpuser\n      POSTGRES_PASSWORD: rppass\n      POSTGRES_DB: reportportal\n    volumes:\n      # For unix host\n      - ./data/postgres:/var/lib/postgresql/data\n      # For windows host\n      # - postgres:/var/lib/postgresql/data\n    ports:\n      - "5432:5432"\n    command:\n      -c checkpoint_completion_target=0.9\n      -c work_mem=96MB\n      -c wal_writer_delay=20ms\n      -c synchronous_commit=off\n      -c wal_buffers=32MB\n      -c min_wal_size=2GB\n      -c max_wal_size=4GB\n    healthcheck:\n      test: ["CMD-SHELL", "pg_isready -d $$POSTGRES_DB -U $$POSTGRES_USER"]\n      interval: 10s\n      timeout: 120s\n      retries: 10\n    restart: always\n  \n  db-scripts:\n    image: reportportal/migrations:5.6.0\n    depends_on:\n      postgres:\n        condition: service_healthy\n    environment:\n      POSTGRES_SERVER: postgres\n      POSTGRES_PORT: 5432\n      POSTGRES_DB: reportportal\n      POSTGRES_USER: rpuser\n      POSTGRES_PASSWORD: rppass\n    restart: on-failure\n\n  minio:\n    image: minio/minio:RELEASE.2020-10-27T04-03-55Z\n    ports:\n      - \'9000:9000\'\n    volumes:\n      # For unix host\n      - ./data/storage:/data\n      # For windows host\n      # - minio:/data\n    environment:\n      MINIO_ACCESS_KEY: minio\n      MINIO_SECRET_KEY: minio123\n    command: server /data\n    healthcheck:\n      test: ["CMD", "curl", "-f", "http://localhost:9000/minio/health/live"]\n      interval: 30s\n      timeout: 20s\n      retries: 3\n    restart: always\n    \nvolumes:\n  postgres:\n  minio:\n')),(0,i.kt)("p",null,"This file will be updated in next sections, but we can already start developing our first service"),(0,i.kt)("h3",{id:"service-authorization"},"Service Authorization"),(0,i.kt)("p",null,"To start up Service Authorization you should fill marked values in the ",(0,i.kt)("inlineCode",{parentName:"p"},"application.yaml")," file:"),(0,i.kt)("media-view",{src:n(9501),alt:"Start Service Authorization"}),(0,i.kt)("media-view",{src:n(82466),alt:"Values you should fill"}),(0,i.kt)("p",null,"(Optional) change ",(0,i.kt)("inlineCode",{parentName:"p"},"context-path")," value from ",(0,i.kt)("inlineCode",{parentName:"p"},"/")," to ",(0,i.kt)("inlineCode",{parentName:"p"},"/uat")," if you are planning to deploy Service UI locally (will be described later)"),(0,i.kt)("h3",{id:"service-api"},"Service API"),(0,i.kt)("p",null,"Before starting Service API we should add RabbitMQ to our deployment. "),(0,i.kt)("p",null,"In ReportPortal RabbitMQ is required for 3 purposes:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"inter-service communication between Service API and Service Analyzer. "),(0,i.kt)("li",{parentName:"ul"},"async reporting feature"),(0,i.kt)("li",{parentName:"ul"},"user activity event publishing")),(0,i.kt)("p",null,"To add RabbitMQ to our deployment we should add the following to our existing ",(0,i.kt)("inlineCode",{parentName:"p"},"docker-compose.yml"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'  rabbitmq:\n    image: rabbitmq:3.7.16-management\n    ports:\n      - "5672:5672"\n      - "15672:15672"\n    environment:\n      RABBITMQ_DEFAULT_USER: "rabbitmq"\n      RABBITMQ_DEFAULT_PASS: "rabbitmq"\n    healthcheck:\n      test: ["CMD", "rabbitmqctl", "status"]\n      retries: 5\n    restart: always\n')),(0,i.kt)("p",null,"We may start deploying Service API right now without any issues, but all Analyzer-related interactions (publishing to analyzer queues and receiving response) won't succeed.\nWe need to deploy Service Analyzer and all its required services. So we add the following to our ",(0,i.kt)("inlineCode",{parentName:"p"},"docker-compose.yml"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'  elasticsearch:\n    image: docker.elastic.co/elasticsearch/elasticsearch:7.10.1\n    volumes:\n      - ./data/elasticsearch:/usr/share/elasticsearch/data\n    environment:\n      - "ES_JAVA_OPTS=-Dlog4j2.formatMsgNoLookups=true"\n      - "bootstrap.memory_lock=true"\n      - "discovery.type=single-node"\n      - "logger.level=INFO"\n      - "xpack.security.enabled=true"\n      - "ELASTIC_PASSWORD=elastic1q2w3e"\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n      nofile:\n        soft: 65536\n        hard: 65536\n    ports:\n      - "9200:9200"\n    healthcheck:\n      test: ["CMD", "curl","-s" ,"-f", "http://elastic:elastic1q2w3e@localhost:9200/_cat/health"]\n    restart: always\n\n  analyzer: \n    image: reportportal/service-auto-analyzer:5.6.0\n    environment:\n      LOGGING_LEVEL: info\n      AMQP_EXCHANGE_NAME: analyzer-default\n      AMQP_URL: amqp://rabbitmq:rabbitmq@rabbitmq:5672\n      ES_HOSTS: http://elastic:elastic1q2w3e@elasticsearch:9200\n      MINIO_SHORT_HOST: minio:9000\n      MINIO_ACCESS_KEY: minio\n      MINIO_SECRET_KEY: minio123\n    depends_on:\n      elasticsearch:\n        condition: service_started\n      rabbitmq:\n        condition: service_healthy\n    restart: always\n')),(0,i.kt)("p",null,"As the result our ",(0,i.kt)("inlineCode",{parentName:"p"},"docker-compose.yml")," should be like ",(0,i.kt)("a",{parentName:"p",href:"pathname:///files/DockerCompose.yml"},"this")),(0,i.kt)("p",null,"To start up Service API you should fill marked values in the ",(0,i.kt)("inlineCode",{parentName:"p"},"application.yaml")," file:"),(0,i.kt)("media-view",{src:n(9501),alt:"Start Service API"}),(0,i.kt)("media-view",{src:n(82466),alt:"Authorization binary Configuration"}),(0,i.kt)("media-view",{src:n(26874),alt:"Rabbitmq Configuration"}),(0,i.kt)("p",null,"(Optional) change ",(0,i.kt)("inlineCode",{parentName:"p"},"context-path")," value from ",(0,i.kt)("inlineCode",{parentName:"p"},"/")," to ",(0,i.kt)("inlineCode",{parentName:"p"},"/api")," if you are planning to deploy Service UI locally (will be described later)"),(0,i.kt)("h3",{id:"service-jobs"},"Service Jobs"),(0,i.kt)("p",null,"To start up Service Jobs you should fill marked values in the ",(0,i.kt)("inlineCode",{parentName:"p"},"application.yaml")," file:"),(0,i.kt)("media-view",{src:n(9501),alt:"Start Service Jobs"}),(0,i.kt)("media-view",{src:n(82466),alt:"Values for binary"}),(0,i.kt)("media-view",{src:n(26874),alt:"Values for Rabbitmq"}),(0,i.kt)("h3",{id:"service-ui"},"Service UI"),(0,i.kt)("p",null,"After all back-end services deployed you may want to interact with them not only using tool like Postman but use ReportPortal UI too.\nTo do this you should do the next steps:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"clone/update ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/reportportal/service-ui"},"Service UI repository")),(0,i.kt)("li",{parentName:"ul"},"checkout ",(0,i.kt)("inlineCode",{parentName:"li"},"develop")," branch"),(0,i.kt)("li",{parentName:"ul"},"apply changes to ",(0,i.kt)("inlineCode",{parentName:"li"},"dev.config.js")," file")),(0,i.kt)("p",null,"before:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"proxy: [\n        {\n          context: ['/composite', '/api/', '/uat/'],\n          target: process.env.PROXY_PATH,\n          bypass(req) {\n            console.log(`proxy url: ${req.url}`);\n          },\n        },\n      ]\n")),(0,i.kt)("p",null,"after:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"proxy: [\n        {\n          context: ['/composite', '/api/'],\n          target: 'http://localhost:8585',\n          bypass(req) {\n            console.log(`proxy url: ${req.url}`);\n          },\n        },\n        {\n          context: ['/uat/'],\n          target: 'http://localhost:9999',\n          bypass(req) {\n            console.log(`proxy url: ${req.url}`);\n          },\n        },\n      ]\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"install NodeJs if it's not installed yet (minimum version is 10)"),(0,i.kt)("li",{parentName:"ul"},"run Service UI from the root folder(service-ui) using commands:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"cd app\nnpm install\nnpm run dev\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"open Service UI page on ",(0,i.kt)("inlineCode",{parentName:"li"},"localhost")," with port ",(0,i.kt)("inlineCode",{parentName:"li"},"3000")," and try to login using default credentials")),(0,i.kt)("h2",{id:"development-workflow"},"Development workflow"),(0,i.kt)("h3",{id:"introduction-to-dependencies"},"Introduction to dependencies"),(0,i.kt)("p",null,"All our Java services besides common dependencies like ",(0,i.kt)("inlineCode",{parentName:"p"},"spring-...")," also have ReportPortal libraries that are separated to different repositories.\nThere is a full list of these dependencies:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/reportportal/commons-dao"},"Commons DAO")," - Data layer dependency with domain model configuration"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/reportportal/commons-model"},"Commons Model")," - REST models dependency"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/reportportal/commons"},"Commons")," - Some common utils for multiple usage purposes"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/reportportal/commons-rules"},"Commons Rules")," - Business rules validation dependency"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/reportportal/plugin-api"},"Plugin API")," - ReportPortal plugin API"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/reportportal/commons-bom"},"Commons BOM")," - POM config for releases")),(0,i.kt)("h3",{id:"updates-in-dependencies"},"Updates in dependencies"),(0,i.kt)("p",null,"Let's pretend that you found a bug when you try to get user from the DB.\nAll logic is invoked within ",(0,i.kt)("inlineCode",{parentName:"p"},"Service API")," but the code with the bug is not directly in sources but in ",(0,i.kt)("inlineCode",{parentName:"p"},"Commons DAO")," dependency.\nHow to apply a fix and check if everything works fine?\nTo do this you should follow these steps:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"clone/update ",(0,i.kt)("inlineCode",{parentName:"li"},"Commons DAO")," repository"),(0,i.kt)("li",{parentName:"ul"},"checkout ",(0,i.kt)("inlineCode",{parentName:"li"},"develop")," branch"),(0,i.kt)("li",{parentName:"ul"},"make changes"),(0,i.kt)("li",{parentName:"ul"},"create branch according to the name policy"),(0,i.kt)("li",{parentName:"ul"},"push to the remote"),(0,i.kt)("li",{parentName:"ul"},"create PR to the ",(0,i.kt)("inlineCode",{parentName:"li"},"develop")," branch\nNow you have your branch on the GitHub page and can see the ",(0,i.kt)("inlineCode",{parentName:"li"},"commit hash"),":")),(0,i.kt)("media-view",{src:n(57367),alt:"Commit hash"}),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"go to the service where your changes should be applied (Service API in our example)"),(0,i.kt)("li",{parentName:"ul"},"copy ",(0,i.kt)("inlineCode",{parentName:"li"},"commit hash")," and replace already existing in the ",(0,i.kt)("inlineCode",{parentName:"li"},"build.gradle")," of the required service (Service API in our example):")),(0,i.kt)("media-view",{src:n(60280),alt:"Build gradle updated"}),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"after re-building project using ",(0,i.kt)("inlineCode",{parentName:"li"},"gradle")," dependency will be resolved and downloaded using ",(0,i.kt)("a",{parentName:"li",href:"https://jitpack.io"},"Jitpack")," tool"),(0,i.kt)("li",{parentName:"ul"},"create branch according to the name policy"),(0,i.kt)("li",{parentName:"ul"},"push to the remote"),(0,i.kt)("li",{parentName:"ul"},"create a PR to the ",(0,i.kt)("inlineCode",{parentName:"li"},"develop")," branch")),(0,i.kt)("h2",{id:"summary-notes"},"Summary notes"),(0,i.kt)("p",null,"This documentation should help you save your time by configuring ReportPortal local dev environment and give you understanding of some standards/conventions that we try stick to."),(0,i.kt)("p",null,"Simplified development workflow should look like this:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"always have the latest schema and data in your local DB instance using ",(0,i.kt)("a",{parentName:"li",href:"#how-to-keep-db-data-up-to-date"},"this instructions")," "),(0,i.kt)("li",{parentName:"ul"},"checkout ",(0,i.kt)("inlineCode",{parentName:"li"},"develop")," branch in the required repository"),(0,i.kt)("li",{parentName:"ul"},"make changes"),(0,i.kt)("li",{parentName:"ul"},"if changes in dependencies are required:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"go to the dependency repository, make changes, create a branch and PR according to conventions"),(0,i.kt)("li",{parentName:"ul"},"using ",(0,i.kt)("inlineCode",{parentName:"li"},"commit hash")," update dependency in the ",(0,i.kt)("inlineCode",{parentName:"li"},"build.gradle")))),(0,i.kt)("li",{parentName:"ul"},"create branch according to the name policy"),(0,i.kt)("li",{parentName:"ul"},"push to the remote"),(0,i.kt)("li",{parentName:"ul"},"create a PR according to the name policy")))}u.isMDXComponent=!0},82466:(e,t,n)=>{n.r(t),n.d(t,{default:()=>a});const a=n.p+"assets/images/AuthBinaryConfig-97c8cb6147fd65b01d0350dbd328c7b0.png"},9501:(e,t,n)=>{n.r(t),n.d(t,{default:()=>a});const a=n.p+"assets/images/AuthDbConfig-a73eda3410d18b21d1048d7e2040e642.png"},60280:(e,t,n)=>{n.r(t),n.d(t,{default:()=>a});const a=n.p+"assets/images/BuildGradleUpdated-8fd604f09a870f4791ae70db319d17aa.png"},57367:(e,t,n)=>{n.r(t),n.d(t,{default:()=>a});const a=n.p+"assets/images/CommitHash-63def4609fff5b777eb35d4210013189.png"},65914:(e,t,n)=>{n.r(t),n.d(t,{default:()=>a});const a=n.p+"assets/images/IdeaFormatter-9ea482076d71a3be86aa618cb24c6d6b.png"},26874:(e,t,n)=>{n.r(t),n.d(t,{default:()=>a});const a=n.p+"assets/images/RabbitmqConfig-f47820cdf414130571299246b36aca62.png"}}]);