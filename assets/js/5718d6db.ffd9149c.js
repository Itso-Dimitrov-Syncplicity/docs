"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[5222],{3905:(e,t,o)=>{o.d(t,{Zo:()=>u,kt:()=>m});var r=o(67294);function n(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function i(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function a(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?i(Object(o),!0).forEach((function(t){n(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function s(e,t){if(null==e)return{};var o,r,n=function(e,t){if(null==e)return{};var o,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)o=i[r],t.indexOf(o)>=0||(n[o]=e[o]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)o=i[r],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}var l=r.createContext({}),p=function(e){var t=r.useContext(l),o=t;return e&&(o="function"==typeof e?e(t):a(a({},t),e)),o},u=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var o=e.components,n=e.mdxType,i=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=p(o),m=n,g=d["".concat(l,".").concat(m)]||d[m]||c[m]||i;return o?r.createElement(g,a(a({ref:t},u),{},{components:o})):r.createElement(g,a({ref:t},u))}));function m(e,t){var o=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=o.length,a=new Array(i);a[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:n,a[1]=s;for(var p=2;p<i;p++)a[p]=o[p];return r.createElement.apply(null,a)}return r.createElement.apply(null,o)}d.displayName="MDXCreateElement"},97937:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>c,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var r=o(87462),n=(o(67294),o(3905));const i={sidebar_position:10,sidebar_label:"How to resolve issues with migration to the new version"},a="How to resolve issues with migration to the new version",s={unversionedId:"issues-troubleshooting/HowToResolveIssuesWithMigrationToTheNewVersion",id:"issues-troubleshooting/HowToResolveIssuesWithMigrationToTheNewVersion",title:"How to resolve issues with migration to the new version",description:"Error: Dirty database version XX. Fix and force version.",source:"@site/docs/issues-troubleshooting/HowToResolveIssuesWithMigrationToTheNewVersion.md",sourceDirName:"issues-troubleshooting",slug:"/issues-troubleshooting/HowToResolveIssuesWithMigrationToTheNewVersion",permalink:"/docs/issues-troubleshooting/HowToResolveIssuesWithMigrationToTheNewVersion",draft:!1,editUrl:"https://github.com/reportportal/docs/blob/develop/docs/issues-troubleshooting/HowToResolveIssuesWithMigrationToTheNewVersion.md",tags:[],version:"current",sidebarPosition:10,frontMatter:{sidebar_position:10,sidebar_label:"How to resolve issues with migration to the new version"},sidebar:"defaultSidebar",previous:{title:"How to clean up the ReportPortal database using VACUUM FULL",permalink:"/docs/issues-troubleshooting/HowToCleanUpTheReportPortalDatabaseUsingVacuumFull"},next:{title:"Case Studies",permalink:"/docs/category/case-studies"}},l={},p=[{value:"Error: Dirty database version XX. Fix and force version.",id:"error-dirty-database-version-xx-fix-and-force-version",level:2},{value:"Error: org.jasypt.exceptions.EncryptionOperationNotPossibleException: null. API doesn&#39;t start. ReportPortal unavailable.",id:"error-orgjasyptexceptionsencryptionoperationnotpossibleexception-null-api-doesnt-start-reportportal-unavailable",level:2}],u={toc:p};function c(e){let{components:t,...o}=e;return(0,n.kt)("wrapper",(0,r.Z)({},u,o,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"how-to-resolve-issues-with-migration-to-the-new-version"},"How to resolve issues with migration to the new version"),(0,n.kt)("h2",{id:"error-dirty-database-version-xx-fix-and-force-version"},"Error: Dirty database version XX. Fix and force version."),(0,n.kt)("p",null,"That means, migration process has been interrupted during XX migration (migration has been started but not finished)"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"At first, you need to check the logs of migration (service itselft and database), it can be helpful, if yes, make some actions based on logs, if not then move next."),(0,n.kt)("li",{parentName:"ol"},"You need to rollback all applied (if any) migration XX parts.")),(0,n.kt)("p",null,"The format for url is the next:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},"https://github.com/reportportal/migrations/blob/develop/migrations/XX_some_name.up.sql\n")),(0,n.kt)("p",null,"(Usually nothing to rollback, but need check)"),(0,n.kt)("ol",{start:3},(0,n.kt)("li",{parentName:"ol"},"Change in schema_migrations table, change values in this table to version=XX-1 (previous successful migration number), and dirty flag set to true."),(0,n.kt)("li",{parentName:"ol"},"Restart migration.")),(0,n.kt)("p",null,'For instance, if you have "Error: Dirty database version 10. Fix and force version." '),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Check the logs(service itselft and database), in case we've found nothing, move next."),(0,n.kt)("li",{parentName:"ol"},"You need to check 10 migration (",(0,n.kt)("a",{parentName:"li",href:"https://github.com/reportportal/migrations/blob/develop/migrations/10_attachment_size.up.sql"},"https://github.com/reportportal/migrations/blob/develop/migrations/10_attachment_size.up.sql"),") and rollback if you have some partly migration."),(0,n.kt)("li",{parentName:"ol"},"Then execute #update schema_migrations set version=9, dirty=f"),(0,n.kt)("li",{parentName:"ol"},"Redeploy RP based on docker-composer for example (migration should be started automatically, if you followed by instructions of installation for this way.)")),(0,n.kt)("h2",{id:"error-orgjasyptexceptionsencryptionoperationnotpossibleexception-null-api-doesnt-start-reportportal-unavailable"},"Error: org.jasypt.exceptions.EncryptionOperationNotPossibleException: null. API doesn't start. ReportPortal unavailable."),(0,n.kt)("p",null,"Minio files are used during migration to change integration passwords encryption.\nFiles in Minio may be corrupted and deleted somehow before migration during Reportportal usage. "),(0,n.kt)("p",null,"Removing existing integrations from db before deploying can help. Creation of a new integration will use a new encryption type."),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Execute the next script in database to remove existing integrations before deploy:")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"DELETE FROM integration WHERE type IN (SELECT id FROM integration_type WHERE name IN ('email', 'jira', 'ldap', 'ad'));\n\n")),(0,n.kt)("ol",{start:2},(0,n.kt)("li",{parentName:"ol"},"Deploy Reportportal"),(0,n.kt)("li",{parentName:"ol"},"Create integrations again")))}c.isMDXComponent=!0}}]);